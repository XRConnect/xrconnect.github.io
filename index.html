<form id="projectForm">
  <h3>í”„ë¡œì íŠ¸ ì œëª©</h3>
  <input type="text" name="title" required placeholder="ì˜ˆ) XR ìº í˜ì¸">

  <h3>ëª©ì </h3>
  <div class="options" data-group="purpose">
    <div class="option-btn" role="checkbox" tabindex="0" aria-checked="false">ë¸Œëœë“œ í™ë³´</div>
    <div class="option-btn" role="checkbox" tabindex="0" aria-checked="false">ì œí’ˆ í™ë³´</div>
    <div class="option-btn" role="checkbox" tabindex="0" aria-checked="false">ì´ë²¤íŠ¸/í–‰ì‚¬</div>
    <div class="option-btn" role="checkbox" tabindex="0" aria-checked="false">ê¸°íƒ€</div>
  </div>

  <h3>ì‚°ì—…</h3>
  <div class="options" data-group="industry">
    <div class="option-btn" role="checkbox" tabindex="0" aria-checked="false">ë¦¬í…Œì¼</div>
    <div class="option-btn" role="checkbox" tabindex="0" aria-checked="false">ë¬¸í™”/ì˜ˆìˆ </div>
    <div class="option-btn" role="checkbox" tabindex="0" aria-checked="false">IT/í†µì‹ </div>
    <div class="option-btn" role="checkbox" tabindex="0" aria-checked="false">ê¸°íƒ€</div>
  </div>

  <h3>ì½˜í…ì¸ </h3>
  <input type="text" name="content" placeholder="ì½˜í…ì¸  ì„¤ëª… (ì„ íƒ)">

  <h3>ë””ë°”ì´ìŠ¤</h3>
  <input type="text" name="device" placeholder="ì‚¬ìš© ë””ë°”ì´ìŠ¤ (ì„ íƒ)">

  <h3>ì°¸ê³ ìë£Œ</h3>
  <input type="text" name="reference" placeholder="ì°¸ê³  URL ë˜ëŠ” ìë£Œ (ì„ íƒ)">

  <h3>ì¼ì • & ì˜ˆì‚°</h3>
  <input type="date" name="start_date" required>
  <input type="date" name="end_date" required>
  <select name="budget" required>
    <option value="" disabled selected>ì˜ˆì‚° ì„ íƒ</option>
    <option value="500ë§Œ ì› ì´í•˜">500ë§Œ ì› ì´í•˜</option>
    <option value="500ë§Œ ~ 1000ë§Œ ì›">500ë§Œ ~ 1000ë§Œ ì›</option>
    <option value="1000ë§Œ ì› ì´ìƒ">1000ë§Œ ì› ì´ìƒ</option>
  </select>
  <select name="nda" required>
    <option value="" disabled selected>NDA ì—¬ë¶€ ì„ íƒ</option>
    <option value="í•„ìš”">í•„ìš”</option>
    <option value="ë¶ˆí•„ìš”">ë¶ˆí•„ìš”</option>
  </select>

  <h3>ë‹´ë‹¹ì ì •ë³´</h3>
  <input type="text" name="name" placeholder="ì´ë¦„" required>
  <input type="email" name="email" placeholder="ì´ë©”ì¼" required>
  <input type="tel" name="phone" placeholder="ì—°ë½ì²˜ (ì˜ˆ: 01012345678)" pattern="[0-9]{10,11}" title="10~11ìë¦¬ ìˆ«ìë§Œ ì…ë ¥">
  <input type="text" name="company" placeholder="íšŒì‚¬ëª… (ì„ íƒ)">

  <button type="submit" id="submitBtn">ë“±ë¡í•˜ê¸° â†’</button>
  <div id="loading" style="display: none; text-align: center; margin-top: 10px;">ì²˜ë¦¬ ì¤‘...</div>
</form>

<style>
  form { font-family: sans-serif; max-width: 500px; margin: 0 auto; }
  h3 { margin-top: 20px; font-size: 16px; }
  input, select { width: 100%; padding: 10px; margin: 8px 0; border: 1px solid #ccc; border-radius: 6px; box-sizing: border-box; }
  .options { display: flex; gap: 8px; flex-wrap: wrap; margin-bottom: 8px; }
  .option-btn { padding: 6px 12px; border: 1px solid #aaa; border-radius: 6px; cursor: pointer; user-select: none; }
  .option-btn.active { background: #000; color: #fff; }
  .option-btn:focus { outline: 2px solid #007bff; }
  button { margin-top: 20px; width: 100%; padding: 12px; background: #000; color: #fff; border: none; border-radius: 6px; cursor: pointer; }
  button:disabled { background: #666; cursor: not-allowed; }
</style>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    console.log("[INIT] ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰ë¨");

    document.querySelectorAll('.options').forEach(container => {
      container.addEventListener('click', (ev) => {
        const btn = ev.target.closest('.option-btn');
        if (!btn || !container.contains(btn)) return;
        btn.classList.toggle('active');
        btn.setAttribute('aria-checked', btn.classList.contains('active'));
        console.log('[TOGGLE]', container.dataset.group, btn.textContent.trim(), btn.classList.contains('active'));
      });

      container.addEventListener('keydown', (ev) => {
        const btn = ev.target.closest('.option-btn');
        if (!btn || !container.contains(btn)) return;
        if (ev.key === 'Enter' || ev.key === ' ') {
          ev.preventDefault();
          btn.classList.toggle('active');
          btn.setAttribute('aria-checked', btn.classList.contains('active'));
          console.log('[TOGGLE-KEY]', container.dataset.group, btn.textContent.trim(), btn.classList.contains('active'));
        }
      });
    });

    const form = document.getElementById('projectForm');
    const submitBtn = document.getElementById('submitBtn');
    const loadingDiv = document.getElementById('loading');

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      console.log("[SUBMIT] ì´ë²¤íŠ¸ ë°œìƒ");

      submitBtn.disabled = true;
      loadingDiv.style.display = 'block';

      const formData = new FormData(form);
      const data = {};
      formData.forEach((v, k) => data[k] = v);

      document.querySelectorAll('.options[data-group]').forEach(container => {
        const key = container.dataset.group;
        const vals = [...container.querySelectorAll('.option-btn.active')].map(x => x.textContent.trim());
        if (vals.length === 0) {
          alert(`âš ï¸ ${key} í•­ëª©ì„ ìµœì†Œ í•˜ë‚˜ ì„ íƒí•´ì£¼ì„¸ìš”.`);
          submitBtn.disabled = false;
          loadingDiv.style.display = 'none';
          return;
        }
        data[key] = vals.join(', ');
      });

      if (!data.purpose || !data.industry) return;

      console.log('[SEND DATA]', data);

      const GAS_URL = 'https://script.google.com/macros/s/AKfycbyyWKmkwDzmXr6ELG5KH-yfY72u-Dj8bzKYknjXgz_akie7eUK6-5QVgmycqYZchznRIg/exec';

      try {
        const resp = await fetch(GAS_URL, {
  method: "POST",
  mode: "no-cors",   // ğŸš¨ ì¶”ê°€
  headers: { "Content-Type": "application/json" },
  body: JSON.stringify(data),
});


        if (!resp.ok) {
          throw new Error(`ì„œë²„ ì˜¤ë¥˜: ${resp.status} ${resp.statusText}`);
        }

        const text = await resp.text();
        console.log('[RAW RESPONSE]', text);

        let json;
        try {
          json = JSON.parse(text);
        } catch (err) {
          throw new Error('ì„œë²„ ì‘ë‹µì´ JSONì´ ì•„ë‹™ë‹ˆë‹¤: ' + text);
        }

        if (json.result === 'success') {
          alert('âœ… ë“±ë¡ ì™„ë£Œ! êµ¬ê¸€ ì‹œíŠ¸ & Slackì— ì „ì†¡ë˜ì—ˆìŠµë‹ˆë‹¤.');
          form.reset();
          document.querySelectorAll('.option-btn').forEach(el => {
            el.classList.remove('active');
            el.setAttribute('aria-checked', 'false');
          });
        } else {
          alert('âš ï¸ ë“±ë¡ ì‹¤íŒ¨: ' + (json.message || JSON.stringify(json)));
        }
      } catch (err) {
        console.error('[SEND ERROR]', err);
        alert('ì„œë²„ ì˜¤ë¥˜ ë°œìƒ: ' + err.message);
      } finally {
        submitBtn.disabled = false;
        loadingDiv.style.display = 'none';
      }
    });
  });
</script>